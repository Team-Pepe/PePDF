{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/jaena/Downloads/toolsapp/lib/services/encryption-service.ts"],"sourcesContent":["import { PDFDocument } from \"pdf-lib\"\nimport JSZip from \"jszip\"\n\n// Type declaration for pdf-encrypt\ndeclare module \"pdf-encrypt\" {\n  interface EncryptOptions {\n    userPassword?: string\n    ownerPassword?: string\n    permissions?: {\n      print?: boolean\n      modify?: boolean\n      copy?: boolean\n      annotate?: boolean\n    }\n  }\n  \n  function pdfEncrypt(\n    buffer: Buffer, \n    options: EncryptOptions, \n    callback: (err: Error | null, result?: Buffer) => void\n  ): void\n  \n  export default pdfEncrypt\n}\n\nimport pdfEncrypt from \"pdf-encrypt\"\n\nexport interface EncryptionOptions {\n  password: string\n  algorithm?: 'AES-256' | 'PDF-Standard'\n  permissions?: {\n    printing?: boolean\n    modifying?: boolean\n    copying?: boolean\n    annotating?: boolean\n  }\n}\n\nexport interface EncryptionResult {\n  blob: Blob\n  fileName: string\n  algorithm: string\n}\n\nexport class EncryptionService {\n  /**\n   * Encrypt a PDF file with password protection\n   */\n  static async encryptPDF(\n    file: File, \n    options: EncryptionOptions\n  ): Promise<EncryptionResult> {\n    try {\n      const arrayBuffer = await file.arrayBuffer()\n      const { password, permissions = {} } = options\n\n      // Set default permissions (restrictive by default)\n      const pdfPermissions = {\n        printing: permissions.printing ?? false,\n        modifying: permissions.modifying ?? false,\n        copying: permissions.copying ?? false,\n        annotating: permissions.annotating ?? false,\n      }\n\n      // Use pdf-encrypt library for real PDF encryption\n      const encryptedBuffer = await new Promise<Buffer>((resolve, reject) => {\n        pdfEncrypt(Buffer.from(arrayBuffer), {\n          userPassword: password,\n          ownerPassword: password + \"_owner\", // Owner password for permissions\n          permissions: {\n            print: pdfPermissions.printing,\n            modify: pdfPermissions.modifying,\n            copy: pdfPermissions.copying,\n            annotate: pdfPermissions.annotating,\n          }\n        }, (err: any, buffer: Buffer) => {\n          if (err) {\n            reject(err)\n          } else {\n            resolve(buffer)\n          }\n        })\n      })\n\n      const blob = new Blob([new Uint8Array(encryptedBuffer)], { type: \"application/pdf\" })\n      const fileName = file.name.replace('.pdf', '-encrypted.pdf')\n\n      return {\n        blob,\n        fileName,\n        algorithm: 'PDF-Standard'\n      }\n    } catch (error) {\n      console.error('Error encrypting PDF:', error)\n      throw new Error('Failed to encrypt PDF file')\n    }\n  }\n\n  /**\n   * Decrypt PDF file with password\n   */\n  static async decryptPDF(\n    file: File, \n    password: string\n  ): Promise<EncryptionResult> {\n    try {\n      const arrayBuffer = await file.arrayBuffer()\n      \n      // Try to load the PDF with the provided password\n      const pdfDoc = await PDFDocument.load(arrayBuffer, { \n        ignoreEncryption: false \n      })\n\n      // If we get here, the PDF was successfully loaded (decrypted)\n      const pdfBytes = await pdfDoc.save()\n      \n      const blob = new Blob([new Uint8Array(pdfBytes)], { type: \"application/pdf\" })\n      const fileName = file.name.replace('.pdf', '-decrypted.pdf')\n\n      return {\n        blob,\n        fileName,\n        algorithm: 'PDF-Standard'\n      }\n    } catch (error) {\n      console.error('Error decrypting PDF:', error)\n      if (error instanceof Error && error.message.includes('password')) {\n        throw new Error('Contrase√±a incorrecta o PDF no encriptado')\n      }\n      throw new Error('Error al desencriptar el archivo PDF')\n    }\n  }\n\n  /**\n   * Check if PDF is encrypted\n   */\n  static async isPDFEncrypted(file: File): Promise<boolean> {\n    try {\n      const arrayBuffer = await file.arrayBuffer()\n      \n      // Try to load without password\n      await PDFDocument.load(arrayBuffer, { ignoreEncryption: false })\n      return false // If successful, it's not encrypted\n    } catch (error) {\n      // If it fails, it might be encrypted\n      return true\n    }\n  }\n\n  /**\n   * Encrypt any file using browser's Web Crypto API\n   */\n  static async encryptFile(\n    file: File, \n    password: string\n  ): Promise<EncryptionResult> {\n    try {\n      // Generate a key from the password\n      const encoder = new TextEncoder()\n      const keyMaterial = await crypto.subtle.importKey(\n        'raw',\n        encoder.encode(password),\n        { name: 'PBKDF2' },\n        false,\n        ['deriveKey']\n      )\n\n      // Generate a random salt\n      const salt = crypto.getRandomValues(new Uint8Array(16))\n      \n      // Derive the actual encryption key\n      const key = await crypto.subtle.deriveKey(\n        {\n          name: 'PBKDF2',\n          salt: salt,\n          iterations: 100000,\n          hash: 'SHA-256'\n        },\n        keyMaterial,\n        { name: 'AES-GCM', length: 256 },\n        false,\n        ['encrypt']\n      )\n\n      // Generate a random IV\n      const iv = crypto.getRandomValues(new Uint8Array(12))\n      \n      // Read file data\n      const fileData = await file.arrayBuffer()\n      \n      // Encrypt the file\n      const encryptedData = await crypto.subtle.encrypt(\n        { name: 'AES-GCM', iv: iv },\n        key,\n        fileData\n      )\n\n      // Combine salt, IV, and encrypted data\n      const combinedData = new Uint8Array(\n        salt.length + iv.length + encryptedData.byteLength\n      )\n      combinedData.set(salt, 0)\n      combinedData.set(iv, salt.length)\n      combinedData.set(new Uint8Array(encryptedData), salt.length + iv.length)\n\n      const blob = new Blob([combinedData], { type: 'application/octet-stream' })\n      const fileName = file.name + '.encrypted'\n\n      return {\n        blob,\n        fileName,\n        algorithm: 'AES-256-GCM'\n      }\n    } catch (error) {\n      console.error('Error encrypting file:', error)\n      throw new Error('Failed to encrypt file')\n    }\n  }\n\n  /**\n   * Encrypt multiple files into a password-protected ZIP\n   */\n  static async encryptMultipleFiles(\n    files: File[], \n    password: string,\n    zipName: string = 'encrypted-files.zip'\n  ): Promise<EncryptionResult> {\n    try {\n      const zip = new JSZip()\n      \n      // Add files to ZIP\n      for (const file of files) {\n        const fileData = await file.arrayBuffer()\n        zip.file(file.name, fileData)\n      }\n\n      // Generate password-protected ZIP\n      const encryptedZip = await zip.generateAsync({\n        type: 'blob',\n        compression: 'DEFLATE',\n        compressionOptions: { level: 6 },\n        // Note: JSZip doesn't support password protection directly\n        // This would need a different library for true password protection\n      })\n\n      return {\n        blob: encryptedZip,\n        fileName: zipName,\n        algorithm: 'ZIP-Deflate'\n      }\n    } catch (error) {\n      console.error('Error creating encrypted ZIP:', error)\n      throw new Error('Failed to create encrypted ZIP file')\n    }\n  }\n\n  /**\n   * Validate password strength\n   */\n  static validatePassword(password: string): {\n    isValid: boolean\n    strength: 'weak' | 'medium' | 'strong'\n    suggestions: string[]\n  } {\n    const suggestions: string[] = []\n    let score = 0\n\n    if (password.length >= 8) score += 1\n    else suggestions.push('Use at least 8 characters')\n\n    if (/[a-z]/.test(password)) score += 1\n    else suggestions.push('Include lowercase letters')\n\n    if (/[A-Z]/.test(password)) score += 1\n    else suggestions.push('Include uppercase letters')\n\n    if (/\\d/.test(password)) score += 1\n    else suggestions.push('Include numbers')\n\n    if (/[^a-zA-Z0-9]/.test(password)) score += 1\n    else suggestions.push('Include special characters')\n\n    const strength = score <= 2 ? 'weak' : score <= 4 ? 'medium' : 'strong'\n    const isValid = score >= 3\n\n    return { isValid, strength, suggestions }\n  }\n\n  /**\n   * Generate a secure random password\n   */\n  static generateSecurePassword(length: number = 16): string {\n    const charset = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*'\n    const array = new Uint8Array(length)\n    crypto.getRandomValues(array)\n    \n    return Array.from(array, byte => charset[byte % charset.length]).join('')\n  }\n}"],"names":[],"mappings":";;;;AAAA;AAAA;AACA;;;;;;;;;AA2CO,MAAM;IACX;;GAEC,GACD,aAAa,WACX,IAAU,EACV,OAA0B,EACC;QAC3B,IAAI;YACF,MAAM,cAAc,MAAM,KAAK,WAAW;YAC1C,MAAM,EAAE,QAAQ,EAAE,cAAc,CAAC,CAAC,EAAE,GAAG;YAEvC,mDAAmD;YACnD,MAAM,iBAAiB;gBACrB,UAAU,YAAY,QAAQ,IAAI;gBAClC,WAAW,YAAY,SAAS,IAAI;gBACpC,SAAS,YAAY,OAAO,IAAI;gBAChC,YAAY,YAAY,UAAU,IAAI;YACxC;YAEA,kDAAkD;YAClD,MAAM,kBAAkB,MAAM,IAAI,QAAgB,CAAC,SAAS;gBAC1D,WAAW,OAAO,IAAI,CAAC,cAAc;oBACnC,cAAc;oBACd,eAAe,WAAW;oBAC1B,aAAa;wBACX,OAAO,eAAe,QAAQ;wBAC9B,QAAQ,eAAe,SAAS;wBAChC,MAAM,eAAe,OAAO;wBAC5B,UAAU,eAAe,UAAU;oBACrC;gBACF,GAAG,CAAC,KAAU;oBACZ,IAAI,KAAK;wBACP,OAAO;oBACT,OAAO;wBACL,QAAQ;oBACV;gBACF;YACF;YAEA,MAAM,OAAO,IAAI,KAAK;gBAAC,IAAI,WAAW;aAAiB,EAAE;gBAAE,MAAM;YAAkB;YACnF,MAAM,WAAW,KAAK,IAAI,CAAC,OAAO,CAAC,QAAQ;YAE3C,OAAO;gBACL;gBACA;gBACA,WAAW;YACb;QACF,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,yBAAyB;YACvC,MAAM,IAAI,MAAM;QAClB;IACF;IAEA;;GAEC,GACD,aAAa,WACX,IAAU,EACV,QAAgB,EACW;QAC3B,IAAI;YACF,MAAM,cAAc,MAAM,KAAK,WAAW;YAE1C,iDAAiD;YACjD,MAAM,SAAS,MAAM,+JAAW,CAAC,IAAI,CAAC,aAAa;gBACjD,kBAAkB;YACpB;YAEA,8DAA8D;YAC9D,MAAM,WAAW,MAAM,OAAO,IAAI;YAElC,MAAM,OAAO,IAAI,KAAK;gBAAC,IAAI,WAAW;aAAU,EAAE;gBAAE,MAAM;YAAkB;YAC5E,MAAM,WAAW,KAAK,IAAI,CAAC,OAAO,CAAC,QAAQ;YAE3C,OAAO;gBACL;gBACA;gBACA,WAAW;YACb;QACF,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,yBAAyB;YACvC,IAAI,iBAAiB,SAAS,MAAM,OAAO,CAAC,QAAQ,CAAC,aAAa;gBAChE,MAAM,IAAI,MAAM;YAClB;YACA,MAAM,IAAI,MAAM;QAClB;IACF;IAEA;;GAEC,GACD,aAAa,eAAe,IAAU,EAAoB;QACxD,IAAI;YACF,MAAM,cAAc,MAAM,KAAK,WAAW;YAE1C,+BAA+B;YAC/B,MAAM,+JAAW,CAAC,IAAI,CAAC,aAAa;gBAAE,kBAAkB;YAAM;YAC9D,OAAO,MAAM,oCAAoC;;QACnD,EAAE,OAAO,OAAO;YACd,qCAAqC;YACrC,OAAO;QACT;IACF;IAEA;;GAEC,GACD,aAAa,YACX,IAAU,EACV,QAAgB,EACW;QAC3B,IAAI;YACF,mCAAmC;YACnC,MAAM,UAAU,IAAI;YACpB,MAAM,cAAc,MAAM,OAAO,MAAM,CAAC,SAAS,CAC/C,OACA,QAAQ,MAAM,CAAC,WACf;gBAAE,MAAM;YAAS,GACjB,OACA;gBAAC;aAAY;YAGf,yBAAyB;YACzB,MAAM,OAAO,OAAO,eAAe,CAAC,IAAI,WAAW;YAEnD,mCAAmC;YACnC,MAAM,MAAM,MAAM,OAAO,MAAM,CAAC,SAAS,CACvC;gBACE,MAAM;gBACN,MAAM;gBACN,YAAY;gBACZ,MAAM;YACR,GACA,aACA;gBAAE,MAAM;gBAAW,QAAQ;YAAI,GAC/B,OACA;gBAAC;aAAU;YAGb,uBAAuB;YACvB,MAAM,KAAK,OAAO,eAAe,CAAC,IAAI,WAAW;YAEjD,iBAAiB;YACjB,MAAM,WAAW,MAAM,KAAK,WAAW;YAEvC,mBAAmB;YACnB,MAAM,gBAAgB,MAAM,OAAO,MAAM,CAAC,OAAO,CAC/C;gBAAE,MAAM;gBAAW,IAAI;YAAG,GAC1B,KACA;YAGF,uCAAuC;YACvC,MAAM,eAAe,IAAI,WACvB,KAAK,MAAM,GAAG,GAAG,MAAM,GAAG,cAAc,UAAU;YAEpD,aAAa,GAAG,CAAC,MAAM;YACvB,aAAa,GAAG,CAAC,IAAI,KAAK,MAAM;YAChC,aAAa,GAAG,CAAC,IAAI,WAAW,gBAAgB,KAAK,MAAM,GAAG,GAAG,MAAM;YAEvE,MAAM,OAAO,IAAI,KAAK;gBAAC;aAAa,EAAE;gBAAE,MAAM;YAA2B;YACzE,MAAM,WAAW,KAAK,IAAI,GAAG;YAE7B,OAAO;gBACL;gBACA;gBACA,WAAW;YACb;QACF,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,0BAA0B;YACxC,MAAM,IAAI,MAAM;QAClB;IACF;IAEA;;GAEC,GACD,aAAa,qBACX,KAAa,EACb,QAAgB,EAChB,UAAkB,qBAAqB,EACZ;QAC3B,IAAI;YACF,MAAM,MAAM,IAAI,gJAAK;YAErB,mBAAmB;YACnB,KAAK,MAAM,QAAQ,MAAO;gBACxB,MAAM,WAAW,MAAM,KAAK,WAAW;gBACvC,IAAI,IAAI,CAAC,KAAK,IAAI,EAAE;YACtB;YAEA,kCAAkC;YAClC,MAAM,eAAe,MAAM,IAAI,aAAa,CAAC;gBAC3C,MAAM;gBACN,aAAa;gBACb,oBAAoB;oBAAE,OAAO;gBAAE;YAGjC;YAEA,OAAO;gBACL,MAAM;gBACN,UAAU;gBACV,WAAW;YACb;QACF,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,iCAAiC;YAC/C,MAAM,IAAI,MAAM;QAClB;IACF;IAEA;;GAEC,GACD,OAAO,iBAAiB,QAAgB,EAItC;QACA,MAAM,cAAwB,EAAE;QAChC,IAAI,QAAQ;QAEZ,IAAI,SAAS,MAAM,IAAI,GAAG,SAAS;aAC9B,YAAY,IAAI,CAAC;QAEtB,IAAI,QAAQ,IAAI,CAAC,WAAW,SAAS;aAChC,YAAY,IAAI,CAAC;QAEtB,IAAI,QAAQ,IAAI,CAAC,WAAW,SAAS;aAChC,YAAY,IAAI,CAAC;QAEtB,IAAI,KAAK,IAAI,CAAC,WAAW,SAAS;aAC7B,YAAY,IAAI,CAAC;QAEtB,IAAI,eAAe,IAAI,CAAC,WAAW,SAAS;aACvC,YAAY,IAAI,CAAC;QAEtB,MAAM,WAAW,SAAS,IAAI,SAAS,SAAS,IAAI,WAAW;QAC/D,MAAM,UAAU,SAAS;QAEzB,OAAO;YAAE;YAAS;YAAU;QAAY;IAC1C;IAEA;;GAEC,GACD,OAAO,uBAAuB,SAAiB,EAAE,EAAU;QACzD,MAAM,UAAU;QAChB,MAAM,QAAQ,IAAI,WAAW;QAC7B,OAAO,eAAe,CAAC;QAEvB,OAAO,MAAM,IAAI,CAAC,OAAO,CAAA,OAAQ,OAAO,CAAC,OAAO,QAAQ,MAAM,CAAC,EAAE,IAAI,CAAC;IACxE;AACF","debugId":null}}]
}